ingress:
  enabled: true
  tls:
    - secretName: ma1sd-tls
      hosts:
        - matrix-identity.g4v.dev
  hosts:
    - host: matrix-identity.g4v.dev
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt
    kubernetes.io/ingress.class: nginx
    kubernetes.io/tls-acme: "true"
config:
  matrix:
    domain: g4v.dev
    v1: true   # deprecated
    v2: true  # MSC2140 API v2. Disabled by default in order to preserve backward compatibility.
  server:
    name: matrix-identity.g4v.dev
    publicUrl: https://matrix-identity.g4v.dev
  storage:
    backend: postgresql
    provider:
      postgresql:
        database: '//postgresql.default.svc.cluster.local:5432/ma1sd'
        username: ma1sd
  session:
    policy:
      validation:
        enabled: false
  dns:
    overwrite:
      homeserver:
        client:
          - name: 'g4v.dev'
            value: 'http://synapse.matrix.svc.cluster.local:8008'
          - name: 'matrix.g4v.dev'
            value: 'http://synapse.matrix.svc.cluster.local:8008'
  forward:
    servers:
      - vector.im
      - matrix.org
  threepid:
    medium:
      email:
        identity:
          # The e-mail to send as.
          from: "matrix-identity@g4v.dev"
        connectors:
          smtp:
            # SMTP host
            host: "odin.dhcp.home"
            tls: 0
            port: 25
  synapseSql:
    enabled: true # enable or disable the hash lookup MSC2140 (default is false)
    type: postgresql
    #connection: //postgresql.default.svc.cluster.local/synapse?user=synapse&password=[redacted]
    lookup:
      # query for retrive 3PIDs for hashes.
      query: 'select user_id as mxid, medium, address from user_threepids'
  hashing:
    enabled: true # enable or disable the hash lookup MSC2140 (default is false)
    pepperLength: 20 # length of the pepper value (default is 20)
    rotationPolicy: per_requests # or `per_seconds` how often the hashes will be updating
    hashStorageType: sql # or `in_memory` where the hashes will be stored
    algorithms:
      - sha256 # hash the 3PID and pepper.
      - none   # the same as v1 bulk lookup
    delay: 2m # how often hashes will be updated if rotation policy = per_seconds (default is 10s)
    requests: 10 # how many lookup requests will be performed before updating hashes if rotation policy = per_requests (default is 10)
  ldap:
    enabled: true
    lookup: true # hash lookup
    connection:
      host: openldap.openldap.svc.cluster.local
      port: 389
      bindDn: cn=admin,dc=gavinmogan,dc=com
      # bindPassword: [redacted]
      baseDNs:
        - 'ou=users,dc=gavinmogan,dc=com'
    attribute:
      uid:
        type: 'uid' # or mxid
        value: 'uid'
      name: 'displayName'
      email:
        - 'mail'
      msisdn:
        - 'telephoneNumber'
        - 'phone'
    identity:
      filter: '(objectClass=inetOrgPerson)'
  logging:
    root: debug
